# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=30, β=2)", "B2 Log-Logistic(α=20, β=3)", "B3 Log-Logistic(α=15, β=4)",
"C1 Gaussian(sd=20)", "C2 Gaussian(sd=15)", "C3 Gaussian(sd=10)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
# 데이터 생성
x <- seq(0, 60, length.out = 300)
# [Uniform Kernel] 구간별 가중치 유지
kernel_A1 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.5,
x >= 30 & x <= 60 ~ 0.1,
TRUE ~ 0
)
}
kernel_A2 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.3,
x >= 30 & x <= 60 ~ 0.05,
TRUE ~ 0
)
}
# f(x) = 1 / (1 + (x/α)^β)
kernel_B1 <- function(x) 1 / (1 + (x / 15)^5)   # Median = 15
kernel_B2 <- function(x) 1 / (1 + (x / 22.5)^5) # Median = 22.5
kernel_B3 <- function(x) 1 / (1 + (x / 30)^5)   # Median = 30
# f(x) = exp(-x^2 / (2 * sd^2))
kernel_C1 <- function(x) exp(-(x^2) / (2 * 20^2))
kernel_C2 <- function(x) exp(-(x^2) / (2 * 15^2))
kernel_C3 <- function(x) exp(-(x^2) / (2 * 10^2))
# 계산
yA1 <- kernel_A1(x)
yA2 <- kernel_A2(x)
yB1 <- kernel_B1(x)
yB2 <- kernel_B2(x)
yB3 <- kernel_B3(x)
yC1 <- kernel_C1(x)
yC2 <- kernel_C2(x)
yC3 <- kernel_C3(x)
# 색상 설정
col_A <- c("#ef8a62", "#b2182b")
col_B <- c("#78c679", "#31a354", "#006837")
col_C <- c("#4292c6", "#2171b5", "#084594")
# 시각화
plot(x, yA1, type = "l", col = col_A[1], lwd = 3, ylim = c(0, 1),
xlab = "x (min)", ylab = "Weight", main = "Distance Decay Functions (0-60 min)")
lines(x, yA2, col = col_A[2], lwd = 3)
lines(x, yB1, col = col_B[1], lwd = 3)
lines(x, yB2, col = col_B[2], lwd = 3)
lines(x, yB3, col = col_B[3], lwd = 3)
lines(x, yC1, col = col_C[1], lwd = 3)
lines(x, yC2, col = col_C[2], lwd = 3)
lines(x, yC3, col = col_C[3], lwd = 3)
# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=15)", "B2 Log-Logistic(α=22.5)", "B3 Log-Logistic(α=30)",
"C1 Gaussian(sd=20)", "C2 Gaussian(sd=15)", "C3 Gaussian(sd=10)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
# 데이터 생성
x <- seq(0, 60, length.out = 300)
# [Uniform Kernel] 구간별 가중치 유지
kernel_A1 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.5,
x >= 30 & x <= 60 ~ 0.1,
TRUE ~ 0
)
}
kernel_A2 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.3,
x >= 30 & x <= 60 ~ 0.05,
TRUE ~ 0
)
}
# f(x) = 1 / (1 + (x/α)^β)
kernel_B1 <- function(x) 1 / (1 + (x / 15)^5)   # Median = 15
kernel_B2 <- function(x) 1 / (1 + (x / 22.5)^5) # Median = 22.5
kernel_B3 <- function(x) 1 / (1 + (x / 30)^5)   # Median = 30
# f(x) = exp(-x^2 / (2 * sd^2))
kernel_C1 <- function(x) exp(-(x^2) / (2 * 24^2))
kernel_C2 <- function(x) exp(-(x^2) / (2 * 18^2))
kernel_C3 <- function(x) exp(-(x^2) / (2 * 12^2))
# 계산
yA1 <- kernel_A1(x)
yA2 <- kernel_A2(x)
yB1 <- kernel_B1(x)
yB2 <- kernel_B2(x)
yB3 <- kernel_B3(x)
yC1 <- kernel_C1(x)
yC2 <- kernel_C2(x)
yC3 <- kernel_C3(x)
# 색상 설정
col_A <- c("#ef8a62", "#b2182b")
col_B <- c("#78c679", "#31a354", "#006837")
col_C <- c("#4292c6", "#2171b5", "#084594")
# 시각화
plot(x, yA1, type = "l", col = col_A[1], lwd = 3, ylim = c(0, 1),
xlab = "x (min)", ylab = "Weight", main = "Distance Decay Functions (0-60 min)")
lines(x, yA2, col = col_A[2], lwd = 3)
lines(x, yB1, col = col_B[1], lwd = 3)
lines(x, yB2, col = col_B[2], lwd = 3)
lines(x, yB3, col = col_B[3], lwd = 3)
lines(x, yC1, col = col_C[1], lwd = 3)
lines(x, yC2, col = col_C[2], lwd = 3)
lines(x, yC3, col = col_C[3], lwd = 3)
# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=15)", "B2 Log-Logistic(α=22.5)", "B3 Log-Logistic(α=30)",
"C1 Gaussian(sd=24)", "C2 Gaussian(sd=18)", "C3 Gaussian(sd=12)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
# 데이터 생성
x <- seq(0, 60, length.out = 300)
# [Uniform Kernel] 구간별 가중치 유지
kernel_A1 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.5,
x >= 30 & x <= 60 ~ 0.1,
TRUE ~ 0
)
}
kernel_A2 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.3,
x >= 30 & x <= 60 ~ 0.05,
TRUE ~ 0
)
}
# f(x) = 1 / (1 + (x/α)^β)
kernel_B1 <- function(x) 1 / (1 + (x / 15)^5)   # Median = 15
kernel_B2 <- function(x) 1 / (1 + (x / 22.5)^5) # Median = 22.5
kernel_B3 <- function(x) 1 / (1 + (x / 30)^5)   # Median = 30
# f(x) = exp(-x^2 / (2 * sd^2))
kernel_C1 <- function(x) exp(-(x^2) / (2 * 28^2))
kernel_C2 <- function(x) exp(-(x^2) / (2 * 20^2))
kernel_C3 <- function(x) exp(-(x^2) / (2 * 12^2))
# 계산
yA1 <- kernel_A1(x)
yA2 <- kernel_A2(x)
yB1 <- kernel_B1(x)
yB2 <- kernel_B2(x)
yB3 <- kernel_B3(x)
yC1 <- kernel_C1(x)
yC2 <- kernel_C2(x)
yC3 <- kernel_C3(x)
# 색상 설정
col_A <- c("#ef8a62", "#b2182b")
col_B <- c("#78c679", "#31a354", "#006837")
col_C <- c("#4292c6", "#2171b5", "#084594")
# 시각화
plot(x, yA1, type = "l", col = col_A[1], lwd = 3, ylim = c(0, 1),
xlab = "x (min)", ylab = "Weight", main = "Distance Decay Functions (0-60 min)")
lines(x, yA2, col = col_A[2], lwd = 3)
lines(x, yB1, col = col_B[1], lwd = 3)
lines(x, yB2, col = col_B[2], lwd = 3)
lines(x, yB3, col = col_B[3], lwd = 3)
lines(x, yC1, col = col_C[1], lwd = 3)
lines(x, yC2, col = col_C[2], lwd = 3)
lines(x, yC3, col = col_C[3], lwd = 3)
# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=15)", "B2 Log-Logistic(α=22.5)", "B3 Log-Logistic(α=30)",
"C1 Gaussian(sd=28)", "C2 Gaussian(sd=20)", "C3 Gaussian(sd=12)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
# 데이터 생성
x <- seq(0, 60, length.out = 300)
# [Uniform Kernel] 구간별 가중치 유지
kernel_A1 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.5,
x >= 30 & x <= 60 ~ 0.1,
TRUE ~ 0
)
}
kernel_A2 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.3,
x >= 30 & x <= 60 ~ 0.05,
TRUE ~ 0
)
}
# f(x) = 1 / (1 + (x/α)^β)
kernel_B1 <- function(x) 1 / (1 + (x / 15)^5)   # Median = 15
kernel_B2 <- function(x) 1 / (1 + (x / 22.5)^5) # Median = 22.5
kernel_B3 <- function(x) 1 / (1 + (x / 30)^5)   # Median = 30
# f(x) = exp(-x^2 / (2 * sd^2))
kernel_C1 <- function(x) exp(-(x^2) / (2 * 26^2))
kernel_C2 <- function(x) exp(-(x^2) / (2 * 20^2))
kernel_C3 <- function(x) exp(-(x^2) / (2 * 12^2))
# 계산
yA1 <- kernel_A1(x)
yA2 <- kernel_A2(x)
yB1 <- kernel_B1(x)
yB2 <- kernel_B2(x)
yB3 <- kernel_B3(x)
yC1 <- kernel_C1(x)
yC2 <- kernel_C2(x)
yC3 <- kernel_C3(x)
# 색상 설정
col_A <- c("#ef8a62", "#b2182b")
col_B <- c("#78c679", "#31a354", "#006837")
col_C <- c("#4292c6", "#2171b5", "#084594")
# 시각화
plot(x, yA1, type = "l", col = col_A[1], lwd = 3, ylim = c(0, 1),
xlab = "x (min)", ylab = "Weight", main = "Distance Decay Functions (0-60 min)")
lines(x, yA2, col = col_A[2], lwd = 3)
lines(x, yB1, col = col_B[1], lwd = 3)
lines(x, yB2, col = col_B[2], lwd = 3)
lines(x, yB3, col = col_B[3], lwd = 3)
lines(x, yC1, col = col_C[1], lwd = 3)
lines(x, yC2, col = col_C[2], lwd = 3)
lines(x, yC3, col = col_C[3], lwd = 3)
# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=15)", "B2 Log-Logistic(α=22.5)", "B3 Log-Logistic(α=30)",
"C1 Gaussian(sd=26)", "C2 Gaussian(sd=20)", "C3 Gaussian(sd=12)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
# 데이터 생성
x <- seq(0, 60, length.out = 300)
# [Uniform Kernel] 구간별 가중치 유지
kernel_A1 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.5,
x >= 30 & x <= 60 ~ 0.15,
TRUE ~ 0
)
}
kernel_A2 <- function(x) {
case_when(
x >= 0 & x < 15 ~ 1,
x >= 15 & x < 30 ~ 0.3,
x >= 30 & x <= 60 ~ 0.05,
TRUE ~ 0
)
}
# f(x) = 1 / (1 + (x/α)^β)
kernel_B1 <- function(x) 1 / (1 + (x / 15)^5)   # Median = 15
kernel_B2 <- function(x) 1 / (1 + (x / 22.5)^5) # Median = 22.5
kernel_B3 <- function(x) 1 / (1 + (x / 30)^5)   # Median = 30
# f(x) = exp(-x^2 / (2 * sd^2))
kernel_C1 <- function(x) exp(-(x^2) / (2 * 26^2))
kernel_C2 <- function(x) exp(-(x^2) / (2 * 20^2))
kernel_C3 <- function(x) exp(-(x^2) / (2 * 12^2))
# 계산
yA1 <- kernel_A1(x)
yA2 <- kernel_A2(x)
yB1 <- kernel_B1(x)
yB2 <- kernel_B2(x)
yB3 <- kernel_B3(x)
yC1 <- kernel_C1(x)
yC2 <- kernel_C2(x)
yC3 <- kernel_C3(x)
# 색상 설정
col_A <- c("#ef8a62", "#b2182b")
col_B <- c("#78c679", "#31a354", "#006837")
col_C <- c("#4292c6", "#2171b5", "#084594")
# 시각화
plot(x, yA1, type = "l", col = col_A[1], lwd = 3, ylim = c(0, 1),
xlab = "x (min)", ylab = "Weight", main = "Distance Decay Functions (0-60 min)")
lines(x, yA2, col = col_A[2], lwd = 3)
lines(x, yB1, col = col_B[1], lwd = 3)
lines(x, yB2, col = col_B[2], lwd = 3)
lines(x, yB3, col = col_B[3], lwd = 3)
lines(x, yC1, col = col_C[1], lwd = 3)
lines(x, yC2, col = col_C[2], lwd = 3)
lines(x, yC3, col = col_C[3], lwd = 3)
# 기준선 및 범례
abline(v = c(15, 30, 60), col = "gray40", lty = "dashed", lwd = 1.3)
legend("topright",
legend = c("A1 Uniform(steep)", "A2 Uniform(gentle)",
"B1 Log-Logistic(α=15)", "B2 Log-Logistic(α=22.5)", "B3 Log-Logistic(α=30)",
"C1 Gaussian(sd=26)", "C2 Gaussian(sd=20)", "C3 Gaussian(sd=12)"),
col = c(col_A, col_B, col_C),
lwd = 3, cex = 0.75, bg = "white")
#| warning: FALSE
#| message: FALSE
# For Tidying
library(tidyverse)
library(readxl)
library(patchwork)
library(hms)
library(data.table)
library(collapse)
library(cols4all)
library(classInt)
library(arrow)
library(grid)
library(gridExtra)
library(magick)
# For Spatial Data Analysis
library(sf)
library(tmap)
library(lwgeom)
library(RANN)
# For gtfs
library(gtfsrouter)
# For parallel processing
library(future)
library(future.apply)
library(future.mirai)
library(furrr)
library(parallel)
# 저장 경로 설정
save_dir <- "preprocessed_data_files/Bogun_9_gtfs_outputs"
save_dir_network <- "preprocessed_data_files/Bogun_6.4_gtfs_outputs"
dir.create(save_dir, showWarnings = FALSE)
# 시도 경계 데이터 (POLYGON)
shp_sido <- st_read("shpfiles/bnd_sido_00_2024_2Q.shp")
# 시군구 경계 데이터 (POLYGON)
shp_sigungu <- st_read("shpfiles/bnd_sigungu_00_2024_2Q.shp")
# 읍면동 경계 데이터 (POLYGON)
shp_adm <- st_read("shpfiles/bnd_dong_00_2024_2Q.shp")
# 집계구 경계 데이터 (POLYGON)    ## 원자료 출처: SGIS 통계지리정보서비스
shp_oa <- st_read("preprocessed_data_files/shp_oa.gpkg")
# 서울시 경계에 맞춰 뽑기
shp_sido_seoul <- shp_sido %>%
filter(SIDO_CD == "11")
shp_sigungu_seoul <- shp_sigungu %>%
filter(str_sub(SIGUNGU_CD, 1, 2) == "11")
shp_adm_seoul <- shp_adm %>%
filter(str_sub(ADM_CD, 1, 2) == "11")
shp_oa_seoul <- shp_oa %>%
filter(str_sub(TOT_REG_CD, 1, 2) == "11")
# 집계구 대표점 (전국)
shp_rp <- st_read("preprocessed_data_files/rep_points_bd_all.gpkg") %>%
left_join(st_drop_geometry(shp_oa))
# 집계구 대표점 (서울시)
shp_rp_seoul <- shp_rp %>%
st_filter(shp_sido_seoul, join = st_within)
# 의원 (전국)
shp_sp <- st_read("preprocessed_data_files/shp_sp_merged.gpkg") %>%
filter(정신건강의학과_전문의수 != 0)
# 의원 (서울시)
shp_sp_seoul <- shp_sp %>%
st_filter(shp_sido_seoul, join = st_within)
# 서울시 위치
tm_shape(shp_sigungu_seoul) +
tm_borders() +
tm_title("서울시 위치") +
tm_compass(position = c("right", "top")) +
tm_scalebar(
breaks = c(0, 5, 10, 15, 20, 25, 30),
position = tm_pos_out(cell.h = "center", cell.v = "bottom",
pos.h = "center", pos.v = "bottom")
)
# 수도권 지역
shp_sido_metropolitan <- shp_sido %>%
filter(SIDO_CD %in% c("11", "23", "31"))   # 서울, 인천, 경기
shp_sigungu_metropolitan <- shp_sigungu %>%
filter(substr(SIGUNGU_CD, 1, 2) %in% c("11", "23", "31"))
# 연구지역 (서울시 40km 반경까지)
shp_studyarea <- shp_sido_seoul %>% st_buffer(40*1000)
tm_shape(shp_sigungu_metropolitan) +
tm_borders(col="gray") +
tm_shape(shp_sido_metropolitan) +
tm_borders() +
tm_shape(shp_studyarea) +
tm_polygons(fill='red', fill_alpha=0.4) +
tm_shape(shp_sigungu_seoul) +
tm_polygons(fill='red') +
tm_title("연구지역 위치 (옅은 붉은색 원)") +
tm_compass(position = c("right", "top")) +
tm_scalebar(
breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80),
position = tm_pos_out(cell.h = "center", cell.v = "bottom",
pos.h = "right", pos.v = "bottom")
)
# 연구지역 전체 집계구 대표점 `shp_rp_studyarea` 및 집계구 경계 `shp_oa_studyarea`
shp_rp_studyarea <- shp_rp %>%
st_filter(shp_studyarea, join = st_within)
shp_oa_studyarea <- shp_oa %>%
filter(TOT_REG_CD %in% shp_rp_studyarea$TOT_REG_CD)
# 서울시 집계구 대표점 `shp_rp_seoul` 및 집계구 경계 `shp_oa_seoul`
shp_rp_seoul <- shp_rp %>%
st_filter(shp_sido_seoul, join = st_within)
shp_oa_seoul <- shp_oa %>%
filter(TOT_REG_CD %in% shp_rp_seoul$TOT_REG_CD)
# 연구지역 시군구 경계, 읍면동 경계
shp_sigungu_studyarea <- shp_sigungu %>%
st_filter(shp_studyarea, join = st_within)
shp_adm_studyarea <- shp_adm %>%
st_filter(shp_studyarea, join = st_within)
shp_sido_simplified <- shp_sido %>%
st_simplify(dTolerance = 1e3)
# 연구지역 전체 의원
main_map <-
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2) +
tm_shape(shp_oa_studyarea) +
tm_borders(col = "gray90", lwd = 0.2) +
tm_shape(shp_adm_studyarea) +
tm_borders(col = "gray70", lwd = 0.3) +
tm_shape(shp_sigungu_studyarea) +
tm_borders(col = "gray50", lwd = 0.5) +
tm_shape(shp_rp_studyarea) +
tm_dots(fill="green", size=0.1, fill_alpha=0.9) +
tm_shape(shp_sigungu_seoul) +
tm_borders(col = "red", col_alpha = 0.6) +
tm_shape(shp_sido_seoul) +
tm_borders(col = "red", lwd=2) +
tm_title("연구지역 집계구 중심점") +
tm_compass(position = tm_pos_in("right", "top")) +
tm_scalebar(
breaks = c(0, 10, 20, 30, 40, 50, 60, 70),
position = tm_pos_out("center", "bottom"),
text.size = 0.8
)
# ---- inset(소지도) 정의 ----
inset_map <-
tm_shape(shp_sido_simplified) +
tm_borders() +
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2) +
tm_shape(shp_sido_seoul) +
tm_borders(col = "red") +
tm_layout(
frame = TRUE,
inner.margins = c(0, 0, 0, 0),
outer.margins = c(0, 0, 0, 0)
)
tmap_arrange(
main_map, inset_map,
ncol = 2,
widths = c(3, 1)
)
# 연구지역 전체 의원 `shp_sp_studyarea`
shp_sp_studyarea <- shp_sp %>%
st_filter(shp_studyarea, join = st_within)
# 연구지역 전체 의원
main_map <-
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2) +
tm_shape(shp_sigungu_studyarea) +
tm_borders(col = "gray50", lwd = 0.5) +
tm_shape(shp_sp_studyarea) +
tm_dots(fill = "blue", fill_alpha = 0.4, size = 0.2) +
tm_shape(shp_sigungu_seoul) +
tm_borders(col = "red", col_alpha = 0.6) +
tm_shape(shp_sido_seoul) +
tm_borders(col = "red", lwd=2) +
tm_title("연구지역 정신건강의학과 의원의 위치") +
tm_compass(position = tm_pos_in("right", "top")) +
tm_scalebar(
breaks = c(0, 10, 20, 30, 40, 50, 60, 70),
position = tm_pos_out("center", "bottom"),
text.size = 0.8
)
# ---- inset(소지도) 정의 ----
inset_map <-
tm_shape(shp_sido_simplified) +
tm_borders() +
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2) +
tm_shape(shp_sido_seoul) +
tm_borders(col = "red") +
tm_layout(
frame = TRUE,
inner.margins = c(0, 0, 0, 0),
outer.margins = c(0, 0, 0, 0)
)
tmap_arrange(
main_map, inset_map,
ncol = 2,
widths = c(3, 1)
)
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2)
tm_shape(shp_studyarea) +
tm_borders(col = "red", col_alpha = 0.4, lwd = 2) +
tm_shape(shp_oa) +
tm_borders(col = "gray90", lwd = 0.2) +
tm_shape(shp_adm) +
tm_borders(col = "gray70", lwd = 0.3) +
tm_shape(shp_sigungu) +
tm_borders(col = "gray50", lwd = 0.5) +
tm_shape(shp_rp_studyarea) +
tm_dots(fill="green", size=0.1, fill_alpha=0.9) +
tm_shape(shp_sigungu_seoul) +
tm_borders(col = "red", col_alpha = 0.6) +
tm_shape(shp_sido_seoul) +
tm_borders(col = "red", lwd=2) +
tm_title("연구지역 집계구 중심점") +
tm_compass(position = tm_pos_in("right", "top")) +
tm_scalebar(
breaks = c(0, 10, 20, 30, 40, 50, 60, 70),
position = tm_pos_out("center", "bottom"),
text.size = 0.8
)
